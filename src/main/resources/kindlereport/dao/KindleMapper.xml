<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kindlereport.dao.KindleMapper">

	<select id="selectTodayKindleList" resultType="kindlereport.model.Kindle">
		select
			*
		from
			Kindle
		where
			releaseDate = #{date}
	</select>
	
	<select id="selectKindle" resultType="java.util.Map">
		select
			asin,
			title,
			releaseDate,
			detailPageURL,
			largeImage
		from
			Kindle
		where
			asin = #{asin}
	</select>
	
	<select id="selectExclusion" resultType="java.lang.String">
		select
			'%'||word||'%'
		from
			EXCLUSION
		where
			active = 1
	</select>
	
	<select id="selectKindleList" resultType="kindlereport.model.KindleTile" parameterType="java.lang.Integer">
		select
			K.asin,
			K.releaseDate,
			K.title,
			K.mediumImage
		from
			Kindle K INNER JOIN KindleRegist R ON K.asin = R.asin
		<if test="order == 4">
			where R.deleteTime is not null
		</if>
		order by
		<choose>
			<when test="order == null or order == 1">
				K.releaseDate desc, K.title asc
			</when>
			<when test="order == 2">
				K.releaseDate asc, K.title asc
			</when>
			<when test="order == 3">
				R.insertTime desc
			</when>
			<when test="order == 4">
				R.deleteTime desc
			</when>
			<otherwise>
				K.releaseDate desc, K.title asc
			</otherwise>
		</choose>
		LIMIT #{limit} OFFSET #{offset}
	</select>
	
	<select id="selectRereaseDateList" parameterType="java.lang.String" resultType="java.lang.String">
<!-- 		select distinct releaseDate from Kindle order by releaseDate desc LIMIT 10 -->
		select distinct releaseDate from Kindle where releaseDate >= #{date} order by releaseDate
	</select>
	
	<select id="selectDayKindleList" parameterType="java.lang.String" resultType="kindlereport.model.KindleTile">
		select
			asin,
			releaseDate,
			title,
			mediumImage
		from
			Kindle
		where
			releaseDate = #{releaseDate}
		order by
			asin desc
	</select>
	
	<select id="selectKindleByAsin" resultType="kindlereport.model.KindleDetail">
		select
			K.asin,
			K.author,
			K.publisher,
			K.releaseDate,
			K.title,
			K.content,
			K.detailPageURL,
			K.largeImage,
			R.insertTime,
			R.updateTime,
			R.deleteTime
		from
			Kindle K INNER JOIN KindleRegist R ON K.asin = R.asin
		where
			K.asin = #{asin}
	</select>
</mapper>
